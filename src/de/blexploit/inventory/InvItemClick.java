package de.blexploit.inventory;

import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.inventory.creator.InvItemManager;
import de.blexploit.players.Mittrollers;
import de.blexploit.players.create.MittrollerEntity;

public final class InvItemClick implements Listener {

	@EventHandler
	private void InteractEvent(PlayerInteractEvent e) {
		if (e.getItem() == null) {
			return;
		}
		if (Mittrollers.containsP(e.getPlayer())) {
			final MittrollerEntity mt = Mittrollers.getP(e.getPlayer());
				for (final InvItem it : InvItemManager.invitems) {
					if (it.getRealItemStack().isSimilar(mt.getPlayer().getInventory().getItemInMainHand())) {
						e.setCancelled(true);
						this.sort_interacts(mt, e, it);
					}
				}
			if (e.getItem().isSimilar(de.blexploit.Start.give_item)) {
				de.blexploit.inventory.open.Auswahl.SeedClick(mt);
			}
		}
	}

	private void sort_interacts(MittrollerEntity mt, PlayerInteractEvent e, InvItem it) {
		if (api.InteractCheck.rigt_click(e)) {
			it.right_click(mt);
			this.changename(mt, it);
		} else if (api.InteractCheck.left_click(e)) {
			it.left_click(mt);
		}
	}

	private void changename(MittrollerEntity mt, InvItem it) {
		if (it.isStatusanzeige()) {
			if (it.isEnable()) {
				final ItemStack old = it.getRealItemStack();
				it.setEnable(false);
				it.onDisable(mt);
				for (final MittrollerEntity mte : Mittrollers.getOnlines()) {
					for (int i = 0; i < mte.getPlayer().getInventory().getSize(); i++) {
						final ItemStack tryreplace = mte.getPlayer().getInventory().getItem(i);
						if (tryreplace != null) {
							if (tryreplace.isSimilar(old)) {
								mte.getPlayer().getInventory().setItem(i, it.getRealItemStack());
								mte.getPlayer().updateInventory();
							}
						}
					}
				}

			} else {
				final ItemStack old = it.getRealItemStack();
				it.setEnable(true);
				it.onEnable(mt);
				for (final MittrollerEntity mte : Mittrollers.getOnlines()) {
					for (int i = 0; i < mte.getPlayer().getInventory().getSize(); i++) {
						final ItemStack tryreplace = mte.getPlayer().getInventory().getItem(i);
						if (tryreplace != null) {
							if (tryreplace.isSimilar(old)) {
								mte.getPlayer().getInventory().setItem(i, it.getRealItemStack());
								mte.getPlayer().updateInventory();
							}
						}
					}
				}
			}
		}
	}

}
