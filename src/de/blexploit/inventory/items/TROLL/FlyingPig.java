package de.blexploit.inventory.items.TROLL;

import java.util.ArrayList;
import java.util.Random;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.entity.Entity;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Pig;
import org.bukkit.plugin.Plugin;
import org.bukkit.util.Vector;

import api.ParticleEffect;
import api.Godmode;
import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.create.MittrollerEntity;

public final class FlyingPig extends InvItem {

	private ArrayList<Entity> Pigs = new ArrayList<Entity>();
	private ArrayList<Integer> shedulers = new ArrayList<Integer>();
	private Plugin pl = Start.instance;

	public FlyingPig() {
		super("FlyingPig", "(R)Erschafft ein wunderschöne Biene;(L)Lässt sie wieder verschwinden", Material.FEATHER, 0,
				Bereich.TROLLING, false);
	}

	@Override
	public void right_click(MittrollerEntity mt) {
		this.spielerInfo(mt, "ist ein Schwein!");
		final Pig pig = (Pig) mt.getPlayer().getWorld().spawnEntity(api.Get.targetLoc(mt.getPlayer()).add(0, 1, 0),
				EntityType.PIG);
		pig.setCustomName("§l§4Ich bin eine Biene!");
		Pigs.add(pig);
		api.Godmode.add(pig);

		shedulers.add(Bukkit.getScheduler().scheduleSyncRepeatingTask(pl, new Runnable() {
			Random rnd = new Random();

			@Override
			public void run() {
				pig.setVelocity(new Vector((rnd.nextDouble() - 0.5) * 6, (rnd.nextDouble() - 0.5),
						(rnd.nextDouble() - 0.5) * 6));
			}
		}, 1, 20));

		shedulers.add(Bukkit.getScheduler().scheduleSyncRepeatingTask(pl, new Runnable() {
			@Override
			public void run() {
				pig.setVelocity(new Vector(0, 0.2, 0));
			}
		}, 1, 5));

		shedulers.add(Bukkit.getScheduler().scheduleSyncRepeatingTask(pl, new Runnable() {
			@Override
			public void run() {
				ParticleEffect.REDSTONE.display(0, 0.25F, 0, 4, 10, pig.getLocation().add(0, -0.25F, 0), 400);
			}
		}, 1, 1));
	}

	@Override
	public void left_click(MittrollerEntity mt) {
		for (Entity et : Pigs) {
			Godmode.remove(et);
			if (et != null) {
				if (et.isDead() == false) {
					et.remove();
				}
			}
		}
		for (int sh : shedulers) {
			Bukkit.getScheduler().cancelTask(sh);
		}
	}

}
