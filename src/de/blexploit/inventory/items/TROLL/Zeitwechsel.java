package de.blexploit.inventory.items.TROLL;

import java.util.ArrayList;
import java.util.HashMap;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.World;
import org.bukkit.plugin.Plugin;

import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.create.MittrollerEntity;

public final class Zeitwechsel extends InvItem {

	public Zeitwechsel() {
		super("Zeitwechsel", "(R)Beschleunigt die Zeit;(L)Setzt sie auf normal zurück", Material.GRASS_BLOCK, 0,
				Bereich.TROLLING, false);
	}

	private int time = 1;
	private int temp = 60;
	private HashMap<World, Integer> taskWorld = new HashMap<World, Integer>();
	private Plugin Zeitwechseltasks = Start.instance;
	private ArrayList<Integer> addint = new ArrayList<>();

	@Override
	public void right_click(MittrollerEntity mt) {
		final World world = mt.getPlayer().getWorld();
		if (taskWorld.containsKey(world)) {
			taskWorld.put(world, taskWorld.get(world) + temp);
		} else {
			taskWorld.put(world, temp);
		}
		this.spielerInfo(mt, "hofft das keiner unter Epilepsie leidet!");
		mt.sendMessage("In der Welt §b" + world.getName() + " §avergeht die Zeit nun §c" + taskWorld.get(world)
				+ "x §aschneller!");
		addint.add(Bukkit.getScheduler().scheduleSyncRepeatingTask(Zeitwechseltasks, new Runnable() {

			@Override
			public void run() {
				if (time == 24000) {
					time = 0;
				}
				world.setTime(time);
				time += temp;
			}
		}, 0, 0));
	}

	@Override
	public void left_click(MittrollerEntity mt) {
		this.spielerInfo(mt, "hat die Zeit wieder normalisiert.");
		for (Integer i : addint) {
			Bukkit.getScheduler().cancelTask(i);
		}
		addint.clear();
		taskWorld.clear();
	}

}
