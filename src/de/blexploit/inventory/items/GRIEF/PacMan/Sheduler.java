package de.blexploit.inventory.items.GRIEF.PacMan;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.Effect;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.entity.FallingBlock;
import org.bukkit.plugin.Plugin;
import org.bukkit.util.Vector;

import de.blexploit.Start;

public final class Sheduler {
	static Plugin pl = Start.instance;
	static ArrayList<Integer> active_shedules = new ArrayList<>();

	static boolean shed = false;

	 static void start() {
		if (shed == true) {
			return;
		}
		shed = true;
		up_velocity();
		sound();
	}

	 static void stop() {
		Bukkit.getScheduler().cancelTask(sheduler);
		Bukkit.getScheduler().cancelTask(sheduler2);
		shed = false;
	}

	static int sheduler;
	static int sheduler2;

	static void up_velocity() {
		sheduler = Bukkit.getScheduler().scheduleSyncRepeatingTask(pl, new Runnable() {

			@Override
			public void run() {
				for (FallingBlock fb : FallingBlocks.activPac) {
					if (fb != null) {
						if (fb.isDead() == false) {
							fb.setVelocity(new Vector(0, 0.12D, 0.5D));
							check_block(fb.getLocation());
						}
					}
				}

			}
		}, 0, 5);
	}
	
	static void sound() {
		sheduler2 = Bukkit.getScheduler().scheduleSyncRepeatingTask(pl, new Runnable() {
			
			@Override
			public void run() {
				if (FallingBlocks.activPac.size() != 0) {
					FallingBlock fb = FallingBlocks.activPac.get(0);
					if (fb != null) {
						api.Send.OnlinePlayersSound("ENTITY_SLIME_ATTACK", fb.getLocation(), 10, 0);
					}
				}
				
			}
		},0, 10);
	}

	static void check_block(Location loc) {
		Block b = loc.getBlock();
		if (b.getType() != Material.AIR) {
			b.setType(Material.AIR);
			b.getWorld().playEffect(b.getLocation(), Effect.STEP_SOUND, 5);
		}
		for (int z = 0; z < 4; z++) {
			for (int x = -2; x < 2; x++) {
				for (int y = -1; y < 2; y++) {
					Block b2 = new Location(loc.getWorld(), loc.getBlockX() + x, loc.getBlockY() + y, loc.getBlockZ() + z)
							.getBlock();
					if (b2.getType() != Material.AIR) {
						b2.setType(Material.AIR);
						if (x == 0) {
						b2.getWorld().playEffect(b2.getLocation(), Effect.STEP_SOUND, 5);
						}
					}
				}
			}
		}
	}

}
