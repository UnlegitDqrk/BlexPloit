package de.blexploit.inventory.items.GRIEF;

import org.bukkit.Bukkit;
import org.bukkit.Chunk;
import org.bukkit.Material;
import org.bukkit.entity.Player;

import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.create.MittrollerEntity;

public final class ResetWorld extends InvItem {

	public ResetWorld() {
		super("ResetWorld", "Setzt deine Chunks komplett zurück!;$4ACHTUNG: Richtet großen irreversiblen Schaden an!", Material.EMPTY_MAP, 0, Bereich.GRIEFING, false);
	}

	@Override
	public void right_click(final MittrollerEntity mt) {
		mt.getPlayer().setItemInHand(null);
		this.spielerInfo(mt, "macht eine neue Welt! Es wird kurz laggen...");

		Bukkit.getScheduler().runTask(Start.instance, new Runnable() {

			@SuppressWarnings("deprecation")
			@Override
			public void run() {
				Player p = mt.getPlayer();
				Chunk[] Chunks = p.getWorld().getLoadedChunks();
				int prozent = 0;
				for (int x = 0; x < Chunks.length; x++) {
					int neup = x * 100 / Chunks.length;
					if (neup != prozent) {
						prozent = neup;
						if ((prozent % 10) == 0) {
							mt.sendMessage("§eResetWorld §a-> " + prozent + "%");
						}
					}
					int ChunkPosX = Chunks[x].getX();
					int ChunkPosZ = Chunks[x].getZ();

					p.getWorld().regenerateChunk(ChunkPosX, ChunkPosZ);
					p.getWorld().refreshChunk(ChunkPosX, ChunkPosZ);
					p.getWorld().unloadChunk(ChunkPosX, ChunkPosZ);
					p.getWorld().loadChunk(ChunkPosX, ChunkPosZ);
				}
				mt.sendMessage("Die Welt wurde erfolgreich zurückgesetzt!");
			}
		});
	}

}
