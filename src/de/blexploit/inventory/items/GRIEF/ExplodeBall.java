package de.blexploit.inventory.items.GRIEF;

import java.util.ArrayList;
import java.util.Random;

import org.bukkit.Effect;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Snowball;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.ProjectileHitEvent;
import org.bukkit.util.Vector;

import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.Mittrollers;
import de.blexploit.players.create.MittrollerEntity;

public final class ExplodeBall extends InvItem implements Listener {
	private final int MaxSnowballs = 1000;
	private ArrayList<Snowball> snwoballs = new ArrayList<>();

	public ExplodeBall() {
		super("TNT-Ball", "(R)Spawnt die Schnebälle;(L)Entfernt sie", Material.BONE, 0, Bereich.GRIEFING, false);
	}

	@Override
	public void right_click(MittrollerEntity mt) {
		Mittrollers.sendMessage("§B" + mt.getPlayername() + " §amag Schneeballschlachten! Er hat das Feuer erwidert!");
		snwoballs.clear();
		Location locs = api.Get.targetLoc(mt.getPlayer());
		Snowball schneeball1 = (Snowball) locs.getWorld().spawnEntity(locs.add(0, 1, 0), EntityType.SNOWBALL);
		schneeball1.setVelocity(new Vector(0, 1, 0));
		snwoballs.add(schneeball1);
	}

	@Override
	public void left_click(MittrollerEntity mt) {
		snwoballs.clear();
		Mittrollers.sendMessage("§B" + mt.getPlayername() + " §awurde das mit den Schneebälle zu blöd!");
	}

	private final Random rnd = new Random();

	@EventHandler
	private void snowball_hit_bottm(ProjectileHitEvent e) {
		if (e.getEntityType() == EntityType.SNOWBALL) {
			Snowball Snowball = (Snowball) e.getEntity();
			if (snwoballs.contains(Snowball)) {
				if (snwoballs.size() < MaxSnowballs) {
					Snowball.getLocation().getWorld().createExplosion(Snowball.getLocation(), 1.0F);
					Snowball schneeball1 = (Snowball) e.getEntity().getLocation().getWorld()
							.spawnEntity(Snowball.getLocation().add(0, 3, 0), EntityType.SNOWBALL);
					Snowball schneeball2 = (Snowball) e.getEntity().getLocation().getWorld()
							.spawnEntity(Snowball.getLocation().add(0, 3, 0), EntityType.SNOWBALL);
					schneeball1.setVelocity(
							new Vector(rnd.nextDouble() - 0.5, rnd.nextDouble() - 0.5, rnd.nextDouble() - 0.5));
					schneeball2
							.setVelocity(new Vector((rnd.nextDouble() - 0.5) * 2, 2, (rnd.nextDouble() - 0.5) * 0.5));
					e.getEntity().getWorld().playEffect(Snowball.getLocation(), Effect.SMOKE, 1);
					e.getEntity().getWorld().playEffect(Snowball.getLocation(), Effect.ENDER_SIGNAL, 1);

					snwoballs.add(schneeball1);
					snwoballs.add(schneeball2);
					e.getEntity().remove();
				} else {
					Snowball.getLocation().getWorld().createExplosion(Snowball.getLocation(), 1.0F);
					Snowball schneeball1 = (Snowball) e.getEntity().getLocation().getWorld()
							.spawnEntity(Snowball.getLocation().add(0, 3, 0), EntityType.SNOWBALL);
					schneeball1.setVelocity(new Vector(rnd.nextDouble() - 0.5, 2, rnd.nextDouble() - 0.5));
					e.getEntity().getWorld().playEffect(Snowball.getLocation(), Effect.SMOKE, 1);
					e.getEntity().getWorld().playEffect(Snowball.getLocation(), Effect.ENDER_SIGNAL, 1);
					snwoballs.add(schneeball1);
					e.getEntity().remove();
				}
				snwoballs.remove(Snowball);
			}
		}
	}

}
