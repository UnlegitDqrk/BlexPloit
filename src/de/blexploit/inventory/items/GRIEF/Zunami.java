package de.blexploit.inventory.items.GRIEF;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.BlockFromToEvent;

import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.create.MittrollerEntity;

public final class Zunami extends InvItem implements Listener {

	public Zunami() {
		super("Zunami", "Diese Welle ist sehr groß!", Material.WATER_BUCKET, 0, Bereich.GRIEFING, true);
	}

	@Override
	public void onEnable(final MittrollerEntity mt) {
		this.spielerInfo(mt, "hat vergessen den Wasserhanhn zu schließen");
		Bukkit.getScheduler().runTask(Start.instance, new Runnable() {

			@Override
			public void run() {
				final Location loc = api.Get.targetLoc(mt.getPlayer());
				for (double x = loc.getX() - 1; x <= loc.getX() + 1; x++) {
					new Location(loc.getWorld(), x, loc.getY() + 4, loc.getZ()).getBlock().setType(Material.WATER);
				}
			}
		});
	}

	@Override
	public void onDisable(final MittrollerEntity mt) {
		this.spielerInfo(mt, "ist aus Zucker");
	}

	@SuppressWarnings("deprecation")
	@EventHandler
	private void onFlow(final BlockFromToEvent e) {
		if (this.isEnable()) {
			Bukkit.getScheduler().runTask(Start.instance, new Runnable() {

				@Override
				public void run() {
					try {
						if (e.getBlock().getType() == Material.WATER
								|| e.getBlock().getType().getId() == 9 && e.getBlock().getData() == (byte) 8) {
							for (double x = e.getBlock().getLocation().getX() - 1; x <= e.getBlock().getLocation()
									.getX() + 1; x++) {
								for (double z = e.getBlock().getLocation().getZ() - 1; z <= e.getBlock().getLocation()
										.getZ() + 1; z++) {
									new Location(e.getBlock().getWorld(), x, e.getBlock().getLocation().getY(), z)
											.getBlock().setType(Material.WATER);
								}
							}
						}
					} catch (Exception ex) {
					}
				}
			});
		}
	}

}
