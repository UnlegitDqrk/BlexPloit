package de.blexploit.inventory.items.GRIEF;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.BlockState;

import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.create.MittrollerEntity;

public final class GewitterWolke extends InvItem {

	public GewitterWolke() {
		super("GewitterWolke", "(R)Bringt sie zum erscheinen.;(L)Sie feuert einen Blitz mit Explosion ab.",
				Material.LEVER, 0, Bereich.GRIEFING, false);
	}

	@SuppressWarnings({ "deprecation", "unlikely-arg-type" })
	@Override
	public void right_click(MittrollerEntity mt) {
		Block block = api.Get.targetLoc(mt.getPlayer()).getBlock();
		final ArrayList<BlockState> changed_blocks = new ArrayList<BlockState>();
		for (int i = 0; i < 30; i++) {
			Block rnd_block = rnd_loc(block.getLocation()).getBlock();
			if (!changed_blocks.contains(rnd_block)) {
				changed_blocks.add(rnd_block.getState());
			}
			rnd_block.setTypeIdAndData(35, (byte) 7, true);
		}
		Bukkit.getScheduler().scheduleSyncDelayedTask(Start.instance, new Runnable() {

			@Override
			public void run() {
				for (BlockState cstate : changed_blocks) {
					cstate.getBlock().setType(Material.AIR);
				}
				changed_blocks.clear();

			}
		}, 5);
	}

	private Location rnd_loc(Location loc) {
		Location nwloc = new Location(loc.getWorld(), loc.getX() + api.Get.rand(-3, 3),
				loc.getY() + api.Get.rand(13, 18), loc.getZ() + api.Get.rand(-5, 5));
		return nwloc;
	}

	@Override
	public void left_click(MittrollerEntity mt) {
		this.spielerInfo(mt, "hat nicht aufgegessen. Nun Shift es ohne " + this.CHAT_COLOR + "Ende...");
		Block block = api.Get.targetLoc(mt.getPlayer()).getBlock();
		block.getWorld().strikeLightning(block.getLocation());
		block.getWorld().createExplosion(block.getLocation(), 5);
	}

}
