package de.blexploit.inventory.items.EINZELTROLL;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.GameMode;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.BlockState;

import de.blexploit.Start;
import de.blexploit.inventory.creator.Bereich;
import de.blexploit.inventory.creator.InvItem;
import de.blexploit.players.Getrollts;
import de.blexploit.players.create.GetrolltEntity;
import de.blexploit.players.create.MittrollerEntity;

public final class Einbauen extends InvItem {
	public final static ArrayList<BlockState> Rollback = new ArrayList<BlockState>();

	public Einbauen() {
		super("Einbauen", "Woher kommt denn eigentlich die Erde?", Material.DIRT, 0, Bereich.EINZELTROLL, false);
	}

	@Override
	public void right_click(MittrollerEntity mt) {
		spielerInfo(mt, "baut gerne Spieler ein!");
		for (final GetrolltEntity gt : Getrollts.getOnlines()) {
			for (int i = +3; i >= -3; i--) {
				for (int i2 = +3; i2 >= -3; i2--) {
					for (int i3 = +3; i3 >= -3; i3--) {
						Location loc = gt.getLocation().add(i, i2, i3);
						Rollback.add(loc.getBlock().getState());
						loc.getBlock().setType(Material.DIRT);
					}
				}
			}
			api.NoMove.add(gt.getPlayer());
			gt.getPlayer().setGameMode(GameMode.ADVENTURE);
			gt.getPlayer().setHealth(6);
			int time = 0;
			for (int i = 0; i < 6; i++) {
				time++;
				Bukkit.getScheduler().scheduleSyncDelayedTask(Start.instance, new Runnable() {

					@Override
					public void run() {
						gt.getPlayer().damage(1D);

					}
				}, 10 * time);
			}
			Bukkit.getScheduler().scheduleSyncDelayedTask(Start.instance, new Runnable() {

				@Override
				public void run() {
					gt.getPlayer().setHealth(0D);
					for (BlockState block : Rollback) {
						block.update(true);
					}
					Rollback.clear();
					api.NoMove.remove(gt.getPlayer());
				}
			}, 60);

		}
	}

}
