package de.blexploit.command;

import java.util.ArrayList;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.event.Listener;
import api.fanciful.mkremins.fanciful.FancyMessage;
import de.blexploit.Start;
import de.blexploit.players.Mittrollers;
import de.blexploit.players.create.MittrollerEntity;

public class Command implements Listener {

	private String Command;
	private String Beschreibung;
	private boolean needadmin = false;

	private String[] args;
	private String[] showingArgs;

	public void run(final String[] args, final MittrollerEntity mt) {
	}

	public boolean isNeedadmin() {
		return this.needadmin;
	}

	public void setNeedAdmin(final boolean needadmin) {
		this.needadmin = needadmin;
	}

	public void setShowingArgs(final String... args) {
		this.showingArgs = args;
	}

	public ArrayList<String> getShowingArgs() {
		if (this.args == null) {
			return null;
		}
		final int maxArgs = this.args.length;
		final ArrayList<String> toReturn = new ArrayList<String>();
		for (int i = 0; i < maxArgs; i++) {
			if (this.showingArgs != null) {
				if (i < this.showingArgs.length) {
					final String addToArray = this.showingArgs[i];
					if (addToArray != null) {
						toReturn.add(addToArray);
					} else {
						toReturn.add(this.args[i]);
					}
				} else {
					toReturn.add(this.args[i]);
				}
			} else {
				toReturn.add(this.args[i]);
			}
		}
		return toReturn;
	}

	@SuppressWarnings({ "rawtypes", "unchecked" })
	public Command(final String Command, final String Beschreibung, final String... args) {
		this.Command = Command;
		this.Beschreibung = Beschreibung;
		this.args = args;

		boolean has = false;

		final Class[] intfs = this.getClass().getInterfaces();
		try {
			for (final Class c : intfs) {
				if (c.isAssignableFrom(Listener.class)) {
					has = true;
				}
			}
		} catch (final Exception e) {
		}

		if (has) {
			Bukkit.getPluginManager().registerEvents(this, Start.instance);
		}
	}

	public String[] getArgs() {
		return this.args;
	}

	public void setArgs(final String[] args) {
		this.args = args;
	}

	public String getCommand() {
		return this.Command;
	}

	public void setCommand(final String command) {
		this.Command = command;
	}

	public String getBeschreibung() {
		return this.Beschreibung;
	}

	public void setBeschreibung(final String beschreibung) {
		this.Beschreibung = beschreibung;
	}

	private double used = 0;
	public final String CHAT_COLOR = "§b";

	public void SpielerInfo(final MittrollerEntity mt, final String msg) {
		this.SpielerInfo(mt, msg, 0);
	}

	public void SpielerInfo(final MittrollerEntity mt, final String msg, final int delay) {
		if (this.used > System.currentTimeMillis()) {
			return;
		}
		final FancyMessage fm = new FancyMessage("§6CMD ➤ §3" + mt.getPlayername() + this.CHAT_COLOR + " " + msg);
		fm.tooltip(ChatColor.YELLOW + "*" + this.getCommand(),
				ChatColor.BLUE + this.getBeschreibung());
		fm.suggest(Start.Befehlzeichen + this.getCommand());

		for (final MittrollerEntity allMitrollers : Mittrollers.getOnlines()) {
			fm.send(allMitrollers.getPlayer());
		}
		this.used = System.currentTimeMillis() + delay;

	}

}
