package de.blexploit.command.cmds;

import java.util.ArrayList;

import org.bukkit.ChatColor;
import org.bukkit.Material;

import api.Fehler;
import api.fanciful.mkremins.fanciful.FancyMessage;
import de.blexploit.Start;
import de.blexploit.command.Command;
import de.blexploit.command.CommandManager;
import de.blexploit.manager.TabManager;
import de.blexploit.players.create.MittrollerEntity;

public final class Help extends Command {

	public Help() {
		super("help", "Bitte helfen Sie mir", TabManager.INSERT_NUMBER);
	}

	final private int MAX_CMD_PAGE = 8;

	public void HelpShow(final MittrollerEntity mt, final int seite) {
		mt.chat_leer(20);
		final int getMaxSites = (int) (CommandManager.Commands.size() / this.MAX_CMD_PAGE + 0.5);

		mt.sendMessage("§6--- §eBLEXPLOIT §bSeite §a" + seite + "§c von §a" + getMaxSites + " §6---");
		if (seite > getMaxSites) {
			mt.fehler("So viele Seiten gibt es nicht^^");
			return;
		}
		final int startItem = (seite - 1) * this.MAX_CMD_PAGE;
		final int endItem = seite * this.MAX_CMD_PAGE;

		for (int i = 0; i < CommandManager.Commands.size(); i++) {
			if (i > startItem && i <= endItem) {
				final Command c = CommandManager.Commands.get(i);
				final FancyMessage fm = new FancyMessage(
						"§d" + c.getCommand() + ChatColor.DARK_RED + " | " + ChatColor.GRAY + c.getBeschreibung());
				fm.suggest(Start.Befehlzeichen + c.getCommand());

				final ArrayList<String> args = c.getShowingArgs();
				final String command = c.getCommand();

				String argMsg = "";
				for (final String a : args) {
					if (a == null) {
						break;
					}
					argMsg = argMsg + " §4[§9" + a.toUpperCase() + "§4]";
				}
				fm.itemTooltip(api.ItemStackBlex.create(Material.CACTUS, 0, ChatColor.YELLOW + "Benutze: ",
						"§2" + Start.Befehlzeichen + command + argMsg, 1, false));

				fm.send(mt.getPlayer());
			}
		}

	}

	@Override
	public void run(final String[] args, final MittrollerEntity mt) {
		if (args.length == 1) {
			this.HelpShow(mt, 1);
			return;
		}
		if (args.length != 2) {
			mt.chat_leer(1);
			mt.fehler(Fehler.ARGUMENT_EXCEPTION);
			mt.benutze(this);
		} else {
			Integer seite;
			try {
				seite = Integer.parseInt(args[1]);
			} catch (final Exception e) {
				mt.fehler("Merkwürdige Zahl!");
				return;
			}
			if (seite == 0) {
				seite++;
			}
			this.HelpShow(mt, seite);
		}
	}

}
