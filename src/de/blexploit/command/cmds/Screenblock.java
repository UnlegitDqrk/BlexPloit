package de.blexploit.command.cmds;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;

import api.Fehler;
import de.blexploit.Start;
import de.blexploit.command.Command;
import de.blexploit.manager.TabManager;
import de.blexploit.players.create.MittrollerEntity;

public final class Screenblock extends Command {

	private ArrayList<Player> blockedPlayers = new ArrayList<Player>();

	public Screenblock() {
		super("screenblock", "Schlieﬂt permanent alle Inventare", TabManager.INSERT_PLAYERNAME);
	}

	@Override
	public void run(String[] args, MittrollerEntity mt) {
		if (args.length == 2) {
			Player victim = api.Get.player(args[1]);
			if (victim != null) {
				if (this.blockedPlayers.contains(victim)) {
					this.blockedPlayers.remove(victim);
					this.SpielerInfo(mt, "hat ßc" + victim.getName() + CHAT_COLOR + " Screen entblockt!");
				} else {
					if (this.id == null) {
						this.shedule();
					}
					this.blockedPlayers.add(victim);
					this.SpielerInfo(mt, "hat ßc" + victim.getName() + CHAT_COLOR + " Screen geblock!");
				}
			} else {
				mt.fehler(Fehler.PLAYER_NOT_FOUND);
			}
		} else {
			mt.fehler(Fehler.ARGUMENT_EXCEPTION);
			mt.benutze(this);
		}
	}

	private Integer id;

	private void shedule() {
		this.id = Bukkit.getScheduler().scheduleSyncRepeatingTask(Start.instance, new Runnable() {

			@Override
			public void run() {
				for (Player p : blockedPlayers) {
					if (p != null) {
						if (p.isOnline()) {
							try {
								p.closeInventory();
							} catch (Exception ex) {

							}
						}
					}
				}
			}
		}, 1, 1);
	}

}
